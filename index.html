<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Glassy Trello Organizer</title>

<style>
:root{
  --bg:#0b0f1a;
  --panel:rgba(255,255,255,0.08);
  --panel-strong:rgba(255,255,255,0.12);
  --border:rgba(255,255,255,0.15);
  --text:#e6ecff;
  --muted:#9aa4c7;
  --accent:#4da3ff;
  --accent-soft:rgba(77,163,255,0.25);
  --blur:14px;
  --radius:14px;
  --radius-sm:10px;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Inter, sans-serif;
}
*{box-sizing:border-box}
html,body{margin:0;height:100%;background:var(--bg);color:var(--text)}
button,input,textarea{font-family:inherit;color:inherit}
button{cursor:pointer}

.app{height:100%;display:flex;flex-direction:column;padding:12px;gap:12px}

/* Header */
.header{display:flex;align-items:center;gap:12px}
.header h1{margin:0;font-size:18px}
.add-tab-btn{
  margin-left:auto;
  padding:8px 14px;
  border:none;
  border-radius:999px;
  background:var(--accent);
  color:#021226;
  font-weight:600;
}

/* Board */
.board{
  flex:1;
  display:flex;
  gap:12px;
  overflow-x:auto;
}
.board::-webkit-scrollbar{height:0}

/* Column */
.column{
  min-width:280px;
  max-width:320px;
  display:flex;
  flex-direction:column;
  background:var(--panel);
  backdrop-filter:blur(var(--blur));
  border:1px solid var(--border);
  border-radius:var(--radius);
}

/* Column header */
.column-header{
  display:flex;
  gap:6px;
  padding:10px;
  border-bottom:1px solid var(--border);
}
.column-title{
  flex:1;
  background:transparent;
  border:none;
  font-weight:600;
}
.column-header button{
  background:none;
  border:none;
  color:var(--muted);
}

/* Tasks */
.task-list{
  flex:1;
  padding:10px;
  display:flex;
  flex-direction:column;
  gap:10px;
  overflow-y:auto;
}
.task-list::-webkit-scrollbar{width:0}

.task{
  background:var(--panel-strong);
  border:1px solid var(--border);
  border-radius:var(--radius-sm);
  padding:8px;
  display:flex;
  flex-direction:column;
  gap:6px;
  touch-action:none;
}
.task.dragging{opacity:.6}

.task-title{
  background:transparent;
  border:none;
  font-weight:600;
}

.task-notes{
  display:none;
  background:transparent;
  border:1px dashed var(--border);
  border-radius:8px;
  padding:6px;
  font-size:13px;
}
.task.expanded .task-notes{display:block}

.task-footer{
  display:flex;
  gap:6px;
}
.task-footer button{
  flex:1;
  border:none;
  border-radius:6px;
  background:var(--accent-soft);
  color:var(--accent);
  font-size:12px;
}

/* Add task */
.add-task{
  display:flex;
  gap:6px;
  padding:10px;
  border-top:1px solid var(--border);
}
.add-task input{
  flex:1;
  padding:6px 8px;
  border-radius:8px;
  border:1px solid var(--border);
  background:transparent;
}
.add-task button{
  width:34px;
  border-radius:8px;
  border:none;
  background:var(--accent);
  color:#021226;
  font-size:18px;
  font-weight:700;
}

@media(max-width:600px){
  .column{min-width:85vw}
}
</style>
</head>
<body>

<div class="app">
  <div class="header">
    <h1>Organizer</h1>
    <button class="add-tab-btn">+ Tab</button>
  </div>
  <div class="board" id="board"></div>
</div>

<script>
/* ---------- State ---------- */
const STORAGE_KEY="trello_glassy_v2";
let state = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {
  columns:[
    {id:id(),title:"To-Do",tasks:[]},
    {id:id(),title:"Working On",tasks:[]},
    {id:id(),title:"Finished",tasks:[]}
  ]
};

function id(){return crypto.randomUUID()}
function save(){localStorage.setItem(STORAGE_KEY,JSON.stringify(state))}

/* ---------- Render ---------- */
const board=document.getElementById("board");

function render(){
  board.innerHTML="";
  state.columns.forEach(col=>{
    const column=document.createElement("div");
    column.className="column";

    const header=document.createElement("div");
    header.className="column-header";

    const title=document.createElement("input");
    title.className="column-title";
    title.value=col.title;
    title.oninput=()=>{col.title=title.value;save()};

    const delCol=document.createElement("button");
    delCol.textContent="✕";
    delCol.onclick=()=>{
      if(confirm("Delete column?")){
        state.columns=state.columns.filter(c=>c!==col);
        save();render();
      }
    };

    header.append(title,delCol);

    const list=document.createElement("div");
    list.className="task-list";

    col.tasks.forEach(task=>list.appendChild(taskCard(task,col)));

    enableDrop(list,col);

    const add=document.createElement("div");
    add.className="add-task";
    const input=document.createElement("input");
    input.placeholder="Add task";
    const plus=document.createElement("button");
    plus.textContent="+";
    plus.onclick=()=>{
      if(!input.value.trim())return;
      col.tasks.push({id:id(),title:input.value,notes:"",expanded:false});
      input.value="";
      save();render();
    };
    add.append(input,plus);

    column.append(header,list,add);
    board.appendChild(column);
  });
}
render();

/* ---------- Task ---------- */
function taskCard(task,col){
  const card=document.createElement("div");
  card.className="task";
  if(task.expanded)card.classList.add("expanded");

  const title=document.createElement("input");
  title.className="task-title";
  title.value=task.title;
  title.oninput=()=>{task.title=title.value;save()};

  const notes=document.createElement("textarea");
  notes.className="task-notes";
  notes.placeholder="Notes…";
  notes.value=task.notes;
  notes.oninput=()=>{task.notes=notes.value;save()};

  const footer=document.createElement("div");
  footer.className="task-footer";

  const toggle=document.createElement("button");
  toggle.textContent="Notes";
  toggle.onclick=()=>{
    task.expanded=!task.expanded;
    save();render();
  };

  const del=document.createElement("button");
  del.textContent="Delete";
  del.onclick=()=>{
    col.tasks=col.tasks.filter(t=>t!==task);
    save();render();
  };

  footer.append(toggle,del);
  card.append(title,notes,footer);

  enableDrag(card,task,col);
  return card;
}

/* ---------- Drag & Drop (FIXED) ---------- */
let dragging=null;

function enableDrag(card,task,col){
  card.addEventListener("pointerdown",e=>{
    dragging={card,task,col};
    card.classList.add("dragging");
    card.setPointerCapture(e.pointerId);
  });

  card.addEventListener("pointerup",()=>{
    if(!dragging)return;
    dragging.card.classList.remove("dragging");
    dragging=null;
    save();render();
  });
}

function enableDrop(list,col){
  list.addEventListener("pointermove",e=>{
    if(!dragging)return;
    e.preventDefault();

    if(dragging.col!==col){
      dragging.col.tasks=dragging.col.tasks.filter(t=>t!==dragging.task);
      col.tasks.push(dragging.task);
      dragging.col=col;
    }

    const items=[...list.children].filter(c=>c!==dragging.card);
    const after=items.find(el=>{
      const r=el.getBoundingClientRect();
      return e.clientY<r.top+r.height/2;
    });

    if(after) list.insertBefore(dragging.card,after);
    else list.appendChild(dragging.card);

    col.tasks.sort(
      (a,b)=>[...list.children].indexOf(
        list.querySelector(`[data-id="${a?.id}"]`)
      )
    );
  });
}

/* ---------- Add Column ---------- */
document.querySelector(".add-tab-btn").onclick=()=>{
  const name=prompt("Column name");
  if(!name)return;
  state.columns.push({id:id(),title:name,tasks:[]});
  save();render();
};
</script>
</body>
</html>